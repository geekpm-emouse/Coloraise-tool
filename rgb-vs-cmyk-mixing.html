<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGB vs CMYK混合对比</title>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --card-bg: white;
            --text-color: #333;
            --border-color: #ddd;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --highlight-bg: #fff3cd;
            --highlight-border: #ffc107;
            --difference-bg: #f8d7da;
            --difference-border: #dc3545;
            --formula-bg: #f0f0f0;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #1a1a1a;
                --card-bg: #2d2d2d;
                --text-color: #e0e0e0;
                --border-color: #555;
                --shadow: 0 2px 4px rgba(0,0,0,0.3);
                --highlight-bg: #3d3d00;
                --highlight-border: #ffcc00;
                --difference-bg: #4d1f1f;
                --difference-border: #ff4444;
                --formula-bg: #3a3a3a;
            }
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .comparison-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .mixing-method {
            flex: 1;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: background-color 0.3s ease;
        }
        .color-display {
            width: 100%;
            height: 100px;
            border: 2px solid #333;
            margin: 10px 0;
            text-align: center;
            line-height: 100px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            border-radius: 4px;
        }
        .formula {
            background: var(--formula-bg);
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 5px 0;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        .original-colors {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .original-color {
            flex: 1;
            text-align: center;
        }
        .original-color .color-display {
            height: 80px;
            line-height: 80px;
        }
        h1, h2, h3 {
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        .highlight {
            background: var(--highlight-bg);
            padding: 15px;
            border-left: 4px solid var(--highlight-border);
            margin: 15px 0;
            border-radius: 4px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .difference {
            background: var(--difference-bg);
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid var(--difference-border);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .color-selection {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin: 20px 0;
            transition: background-color 0.3s ease;
        }
        .color-inputs {
            display: flex;
            gap: 20px;
            margin: 15px 0;
        }
        .color-input-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .color-input-group label {
            font-weight: bold;
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        .color-input-group input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .color-input-group input[type="text"] {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: monospace;
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .input-row input[type="text"] {
            flex: 1;
        }
        
        .input-toggle {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .input-toggle:hover {
            background: var(--highlight-bg);
        }
        
        .input-toggle.active {
            background: var(--highlight-border);
            color: white;
        }
        
        .result-display {
            cursor: pointer;
            transition: transform 0.2s ease;
            user-select: none;
        }
        
        .result-display:hover {
            transform: scale(1.02);
        }
        
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .copy-notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        .color-input-group .color-display {
            height: 60px;
            line-height: 60px;
            font-size: 14px;
        }
        .ratio-control {
            text-align: center;
            margin: 20px 0;
        }
        .ratio-control label {
            font-weight: bold;
            margin-right: 10px;
        }
        .ratio-control input[type="range"] {
            width: 300px;
            margin: 0 10px;
        }
        .ratio-control span {
            font-weight: bold;
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        
        /* 响应式设计 - 手机端适配 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 14px;
            }
            
            .comparison-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .mixing-method {
                padding: 15px;
            }
            
            .color-inputs {
                flex-direction: column;
                gap: 15px;
            }
            
            .color-input-group {
                display: grid;
                grid-template-columns: 1fr 80px;
                grid-template-rows: auto auto auto;
                gap: 8px;
                align-items: center;
            }
            
            .color-input-group label {
                grid-column: 1 / -1;
                font-size: 16px;
                margin-bottom: 5px;
            }
            
            .color-input-group input[type="color"] {
                grid-column: 2;
                grid-row: 2;
                width: 70px;
                height: 50px;
            }
            
            .color-input-group input[type="text"] {
                grid-column: 1;
                grid-row: 2;
                padding: 12px;
                font-size: 14px;
            }
            
            .color-input-group .color-display {
                grid-column: 1 / -1;
                grid-row: 3;
                height: 50px;
                line-height: 50px;
                font-size: 12px;
            }
            
            .ratio-control {
                margin: 15px 0;
            }
            
            .ratio-control label {
                display: block;
                margin-bottom: 10px;
                font-size: 16px;
            }
            
            .ratio-control input[type="range"] {
                width: 100%;
                max-width: 300px;
                height: 40px;
                margin: 10px 0;
            }
            
            .ratio-control span {
                display: block;
                font-size: 16px;
                margin-top: 10px;
            }
            
            .formula {
                font-size: 12px;
                line-height: 1.4;
                overflow-x: auto;
                white-space: normal;
                word-wrap: break-word;
                padding: 8px;
                text-align: left;
            }
            
            .formula br {
                display: block;
                margin: 4px 0;
            }
            
            .formula strong {
                display: block;
                margin: 8px 0 4px 0;
            }
            
            .color-display {
                height: 80px;
                line-height: 80px;
                font-size: 14px;
            }
            
            h1 {
                font-size: 24px;
                text-align: center;
                margin-bottom: 20px;
            }
            
            h2 {
                font-size: 20px;
                margin-bottom: 15px;
            }
            
            h3 {
                font-size: 18px;
                margin-bottom: 10px;
            }
            
            .highlight, .difference {
                padding: 12px;
                margin: 12px 0;
            }
            
            .highlight p, .difference p {
                margin: 8px 0;
                line-height: 1.4;
            }
        }
        
        /* 超小屏幕适配 */
        @media (max-width: 480px) {
            body {
                padding: 5px;
                font-size: 13px;
            }
            
            .mixing-method {
                padding: 10px;
            }
            
            .color-input-group input[type="text"] {
                font-size: 12px;
                padding: 10px;
            }
            
            .formula {
                font-size: 11px;
                padding: 6px;
                line-height: 1.3;
                text-align: left;
            }
            
            .formula strong {
                display: block;
                margin: 6px 0 3px 0;
                font-size: 12px;
            }
            
            .formula br {
                display: block;
                margin: 3px 0;
            }
            
            .color-display {
                height: 60px;
                line-height: 60px;
                font-size: 12px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            h2 {
                font-size: 18px;
            }
            
            h3 {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <h1>RGB加色混合 vs CMYK减色混合对比</h1>
    
    <div class="highlight">
        <h3>混合原理对比：</h3>
        <p><strong>RGB加色混合：</strong> 光线叠加，颜色越混越亮（屏幕显示原理）</p>
        <p><strong>CMYK减色混合：</strong> 颜料叠加，颜色越混越暗（印刷原理）</p>
    </div>

    <div class="color-selection">
        <h3>选择要混合的颜色：</h3>
        <div class="color-inputs">
            <div class="color-input-group">
                <label>颜色1：</label>
                <input type="color" id="color1Picker" value="#ff0000">
                <div class="input-row">
                    <input type="text" id="color1Text" value="rgb(255, 0, 0)" placeholder="RGB或十六进制">
                    <button type="button" class="input-toggle" id="color1Toggle">HEX</button>
                </div>
                <div class="color-display" id="color1Display" style="background-color: rgb(255, 0, 0);">颜色1</div>
            </div>
            <div class="color-input-group">
                <label>颜色2：</label>
                <input type="color" id="color2Picker" value="#0000ff">
                <div class="input-row">
                    <input type="text" id="color2Text" value="rgb(0, 0, 255)" placeholder="RGB或十六进制">
                    <button type="button" class="input-toggle" id="color2Toggle">HEX</button>
                </div>
                <div class="color-display" id="color2Display" style="background-color: rgb(0, 0, 255);">颜色2</div>
            </div>
        </div>
        <div class="ratio-control">
            <label for="mixRatio">混合比例：</label>
            <input type="range" id="mixRatio" min="0" max="100" value="50">
            <span id="ratioValue">50% : 50%</span>
        </div>
    </div>

    <!-- 混合结果预览区域 -->
    <div class="comparison-container">
        <div class="mixing-method">
            <h2>RGB加色混合结果</h2>
            <div id="rgbResult" class="color-display result-display">RGB混合结果</div>
            <div style="text-align: center; margin-top: 10px;">
                <div class="result-display" id="rgbDecResult" style="cursor: pointer; padding: 5px; background: var(--formula-bg); border-radius: 4px; margin: 2px; font-family: monospace;">rgb(128, 0, 128)</div>
                <div class="result-display" id="rgbHexResult" style="cursor: pointer; padding: 5px; background: var(--formula-bg); border-radius: 4px; margin: 2px; font-family: monospace;">#800080</div>
            </div>
        </div>

        <div class="mixing-method">
            <h2>CMYK减色混合结果</h2>
            <div id="cmykResult" class="color-display result-display">CMYK混合结果</div>
            <div style="text-align: center; margin-top: 10px;">
                <div class="result-display" id="cmykDecResult" style="cursor: pointer; padding: 5px; background: var(--formula-bg); border-radius: 4px; margin: 2px; font-family: monospace;">rgb(128, 64, 128)</div>
                <div class="result-display" id="cmykHexResult" style="cursor: pointer; padding: 5px; background: var(--formula-bg); border-radius: 4px; margin: 2px; font-family: monospace;">#804080</div>
            </div>
        </div>
    </div>

    <!-- 复制成功提醒 -->
    <div id="copyNotification" class="copy-notification">
        已复制到剪贴板！
    </div>

    <div class="difference">
        <h3>两种混合方式的差异分析：</h3>
        <div id="differenceAnalysis"></div>
    </div>

    <!-- 计算公式区域 -->
    <div class="comparison-container">
        <div class="mixing-method">
            <h2>RGB加色混合公式</h2>
            <div class="formula">
                <strong>加色混合公式：</strong><br>
                mixed = color1 × ratio1 + color2 × ratio2<br><br>
                
                <strong>计算过程：</strong><br>
                R = 255 × 0.5 + 0 × 0.5 = 127.5 ≈ 128<br>
                G = 0 × 0.5 + 0 × 0.5 = 0<br>
                B = 0 × 0.5 + 255 × 0.5 = 127.5 ≈ 128<br><br>
                
                <strong>结果：RGB(128, 0, 128)</strong>
            </div>
        </div>

        <div class="mixing-method">
            <h2>CMYK减色混合公式</h2>
            <div class="formula">
                <strong>步骤1：RGB转CMYK</strong><br>
                红色RGB(255, 0, 0) → CMYK转换：<br>
                • 归一化：R=1.0, G=0.0, B=0.0<br>
                • K = 1 - max(R,G,B) = 1 - 1.0 = 0<br>
                • C = (1-R-K)/(1-K) = (1-1.0-0)/(1-0) = 0<br>
                • M = (1-G-K)/(1-K) = (1-0.0-0)/(1-0) = 1.0<br>
                • Y = (1-B-K)/(1-K) = (1-0.0-0)/(1-0) = 1.0<br>
                • 结果：C=0%, M=100%, Y=100%, K=0%<br><br>
                
                蓝色RGB(0, 0, 255) → CMYK转换：<br>
                • 归一化：R=0.0, G=0.0, B=1.0<br>
                • K = 1 - max(R,G,B) = 1 - 1.0 = 0<br>
                • C = (1-R-K)/(1-K) = (1-0.0-0)/(1-0) = 1.0<br>
                • M = (1-G-K)/(1-K) = (1-0.0-0)/(1-0) = 1.0<br>
                • Y = (1-B-K)/(1-K) = (1-1.0-0)/(1-0) = 0<br>
                • 结果：C=100%, M=100%, Y=0%, K=0%<br><br>
                
                <strong>步骤2：CMYK减色混合（50%:50%比例）</strong><br>
                减色混合公式：mixed = 1 - (1 - d1×ratio1) × (1 - d2×ratio2)<br><br>
                
                C通道混合：<br>
                • 颜色1密度：0% × 50% = 0%<br>
                • 颜色2密度：100% × 50% = 50%<br>
                • 混合结果：1 - (1-0) × (1-0.5) = 1 - 1 × 0.5 = 50%<br><br>
                
                M通道混合：<br>
                • 颜色1密度：100% × 50% = 50%<br>
                • 颜色2密度：100% × 50% = 50%<br>
                • 混合结果：1 - (1-0.5) × (1-0.5) = 1 - 0.5 × 0.5 = 75%<br><br>
                
                Y通道混合：<br>
                • 颜色1密度：100% × 50% = 50%<br>
                • 颜色2密度：0% × 50% = 0%<br>
                • 混合结果：1 - (1-0.5) × (1-0) = 1 - 0.5 × 1 = 50%<br><br>
                
                K通道混合：<br>
                • 颜色1密度：0% × 50% = 0%<br>
                • 颜色2密度：0% × 50% = 0%<br>
                • 混合结果：1 - (1-0) × (1-0) = 1 - 1 × 1 = 0%<br><br>
                
                <strong>混合结果CMYK：C=50%, M=75%, Y=50%, K=0%</strong><br><br>
                
                <strong>步骤3：CMYK转回RGB</strong><br>
                转换公式：RGB = 255 × (1-C/100) × (1-M/100) × (1-Y/100) × (1-K/100)<br>
                简化公式：RGB = 255 × (1-C) × (1-K) （每个通道独立计算）<br><br>
                
                R = 255 × (1-0.50) × (1-0) = 255 × 0.50 = 127.5 ≈ 128<br>
                G = 255 × (1-0.75) × (1-0) = 255 × 0.25 = 63.75 ≈ 64<br>
                B = 255 × (1-0.50) × (1-0) = 255 × 0.50 = 127.5 ≈ 128<br><br>
                
                <strong>最终结果：RGB(128, 64, 128)</strong>
            </div>
        </div>
    </div>

    <div class="highlight">
        <h3>实际应用场景：</h3>
        <p><strong>RGB混合：</strong> 适用于屏幕显示、LED灯光混合等加色系统</p>
        <p><strong>CMYK混合：</strong> 适用于印刷、颜料调色、口红调色等减色系统</p>
        <p><strong>口红调色工具：</strong> 应该使用CMYK减色混合，因为口红是颜料性质的</p>
    </div>

    <script>
        // 当前颜色状态
        let currentColors = {
            color1: { r: 255, g: 0, b: 0 },
            color2: { r: 0, g: 0, b: 255 }
        };
        let currentRatio = 0.5;
        
        // 输入格式状态 (true: HEX, false: RGB)
        let inputFormats = {
            color1: false, // 默认RGB格式
            color2: false  // 默认RGB格式
        };

        // 颜色转换函数
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function parseColorInput(input) {
            input = input.trim();
            
            // 十六进制格式
            if (input.startsWith('#')) {
                return hexToRgb(input);
            }
            
            // RGB格式
            const rgbMatch = input.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);
            if (rgbMatch) {
                return {
                    r: parseInt(rgbMatch[1]),
                    g: parseInt(rgbMatch[2]),
                    b: parseInt(rgbMatch[3])
                };
            }
            
            return null;
        }

        // RGB加色混合
        function mixRgbAdditive(rgb1, rgb2, ratio) {
            return {
                r: Math.round(rgb1.r * (1 - ratio) + rgb2.r * ratio),
                g: Math.round(rgb1.g * (1 - ratio) + rgb2.g * ratio),
                b: Math.round(rgb1.b * (1 - ratio) + rgb2.b * ratio)
            };
        }

        // CMYK相关函数
        function rgbToCmyk(r, g, b) {
            r = r / 255;
            g = g / 255;
            b = b / 255;

            const k = 1 - Math.max(r, Math.max(g, b));
            
            if (k >= 1) {
                return { c: 0, m: 0, y: 0, k: 100 };
            }

            const c = (1 - r - k) / (1 - k);
            const m = (1 - g - k) / (1 - k);
            const y = (1 - b - k) / (1 - k);

            return {
                c: Math.round(Math.max(0, Math.min(100, c * 100))),
                m: Math.round(Math.max(0, Math.min(100, m * 100))),
                y: Math.round(Math.max(0, Math.min(100, y * 100))),
                k: Math.round(Math.max(0, Math.min(100, k * 100)))
            };
        }

        function cmykToRgb(c, m, y, k) {
            c = Math.max(0, Math.min(100, c)) / 100;
            m = Math.max(0, Math.min(100, m)) / 100;
            y = Math.max(0, Math.min(100, y)) / 100;
            k = Math.max(0, Math.min(100, k)) / 100;

            const r = 255 * (1 - c) * (1 - k);
            const g = 255 * (1 - m) * (1 - k);
            const b = 255 * (1 - y) * (1 - k);

            return {
                r: Math.round(Math.max(0, Math.min(255, r))),
                g: Math.round(Math.max(0, Math.min(255, g))),
                b: Math.round(Math.max(0, Math.min(255, b)))
            };
        }

        function mixCmykSubtractive(cmyk1, cmyk2, ratio) {
            const density1 = {
                c: cmyk1.c / 100,
                m: cmyk1.m / 100,
                y: cmyk1.y / 100,
                k: cmyk1.k / 100
            };
            
            const density2 = {
                c: cmyk2.c / 100,
                m: cmyk2.m / 100,
                y: cmyk2.y / 100,
                k: cmyk2.k / 100
            };
            
            const effectiveDensity1 = {
                c: density1.c * (1 - ratio),
                m: density1.m * (1 - ratio),
                y: density1.y * (1 - ratio),
                k: density1.k * (1 - ratio)
            };
            
            const effectiveDensity2 = {
                c: density2.c * ratio,
                m: density2.m * ratio,
                y: density2.y * ratio,
                k: density2.k * ratio
            };
            
            const mixedDensity = {
                c: 1 - (1 - effectiveDensity1.c) * (1 - effectiveDensity2.c),
                m: 1 - (1 - effectiveDensity1.m) * (1 - effectiveDensity2.m),
                y: 1 - (1 - effectiveDensity1.y) * (1 - effectiveDensity2.y),
                k: 1 - (1 - effectiveDensity1.k) * (1 - effectiveDensity2.k)
            };
            
            return {
                c: Math.round(Math.min(100, mixedDensity.c * 100)),
                m: Math.round(Math.min(100, mixedDensity.m * 100)),
                y: Math.round(Math.min(100, mixedDensity.y * 100)),
                k: Math.round(Math.min(100, mixedDensity.k * 100))
            };
        }

        // 更新颜色显示
        function updateColorDisplay(colorNum, rgb) {
            const display = document.getElementById(`color${colorNum}Display`);
            const picker = document.getElementById(`color${colorNum}Picker`);
            const text = document.getElementById(`color${colorNum}Text`);
            const toggle = document.getElementById(`color${colorNum}Toggle`);
            
            display.style.backgroundColor = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
            display.textContent = `RGB(${rgb.r}, ${rgb.g}, ${rgb.b})`;
            picker.value = rgbToHex(rgb.r, rgb.g, rgb.b);
            
            // 根据当前格式更新文本输入框
            if (inputFormats[`color${colorNum}`]) {
                text.value = rgbToHex(rgb.r, rgb.g, rgb.b);
                toggle.textContent = 'RGB';
                toggle.classList.add('active');
            } else {
                text.value = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                toggle.textContent = 'HEX';
                toggle.classList.remove('active');
            }
        }
        
        // 切换输入格式
        function toggleInputFormat(colorNum) {
            const currentFormat = inputFormats[`color${colorNum}`];
            inputFormats[`color${colorNum}`] = !currentFormat;
            
            const rgb = currentColors[`color${colorNum}`];
            updateColorDisplay(colorNum, rgb);
        }
        
        // 复制到剪贴板
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                showCopyNotification();
            } catch (err) {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopyNotification();
            }
        }
        
        // 显示复制成功提醒
        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        // 更新混合结果
        function updateMixingResults() {
            const ratio1 = 1 - currentRatio;
            const ratio2 = currentRatio;
            
            // 更新比例显示
            document.getElementById('ratioValue').textContent = 
                `${Math.round(ratio1 * 100)}% : ${Math.round(ratio2 * 100)}%`;
            
            // RGB加色混合
            const rgbMixed = mixRgbAdditive(currentColors.color1, currentColors.color2, currentRatio);
            
            // CMYK减色混合
            const cmyk1 = rgbToCmyk(currentColors.color1.r, currentColors.color1.g, currentColors.color1.b);
            const cmyk2 = rgbToCmyk(currentColors.color2.r, currentColors.color2.g, currentColors.color2.b);
            const cmykMixed = mixCmykSubtractive(cmyk1, cmyk2, currentRatio);
            const cmykToRgbResult = cmykToRgb(cmykMixed.c, cmykMixed.m, cmykMixed.y, cmykMixed.k);
            
            // 更新显示
            const rgbResult = document.getElementById('rgbResult');
            rgbResult.style.backgroundColor = `rgb(${rgbMixed.r}, ${rgbMixed.g}, ${rgbMixed.b})`;
            rgbResult.textContent = `RGB(${rgbMixed.r}, ${rgbMixed.g}, ${rgbMixed.b})`;

            const cmykResult = document.getElementById('cmykResult');
            cmykResult.style.backgroundColor = `rgb(${cmykToRgbResult.r}, ${cmykToRgbResult.g}, ${cmykToRgbResult.b})`;
            cmykResult.textContent = `RGB(${cmykToRgbResult.r}, ${cmykToRgbResult.g}, ${cmykToRgbResult.b})`;
            
            // 更新结果显示的十进制和十六进制格式
            document.getElementById('rgbDecResult').textContent = `rgb(${rgbMixed.r}, ${rgbMixed.g}, ${rgbMixed.b})`;
            document.getElementById('rgbHexResult').textContent = rgbToHex(rgbMixed.r, rgbMixed.g, rgbMixed.b);
            document.getElementById('cmykDecResult').textContent = `rgb(${cmykToRgbResult.r}, ${cmykToRgbResult.g}, ${cmykToRgbResult.b})`;
            document.getElementById('cmykHexResult').textContent = rgbToHex(cmykToRgbResult.r, cmykToRgbResult.g, cmykToRgbResult.b);

            // 更新差异分析
            const differenceAnalysis = document.getElementById('differenceAnalysis');
            const rDiff = Math.abs(rgbMixed.r - cmykToRgbResult.r);
            const gDiff = Math.abs(rgbMixed.g - cmykToRgbResult.g);
            const bDiff = Math.abs(rgbMixed.b - cmykToRgbResult.b);
            
            differenceAnalysis.innerHTML = `
                <p><strong>RGB加色混合：</strong> RGB(${rgbMixed.r}, ${rgbMixed.g}, ${rgbMixed.b})</p>
                <p><strong>CMYK减色混合：</strong> RGB(${cmykToRgbResult.r}, ${cmykToRgbResult.g}, ${cmykToRgbResult.b})</p>
                <p><strong>数值差异：</strong> R差${rDiff}, G差${gDiff}, B差${bDiff}</p>
                <p><strong>视觉差异：</strong> ${gDiff > 10 ? 'CMYK混合结果明显更暗' : '两种混合结果较为接近'}</p>
                <p><strong>CMYK值：</strong> C:${cmykMixed.c}% M:${cmykMixed.m}% Y:${cmykMixed.y}% K:${cmykMixed.k}%</p>
            `;
            
            // 动态更新混合公式
            updateFormulas(rgbMixed, cmyk1, cmyk2, cmykMixed, cmykToRgbResult, ratio1, ratio2);
        }
        
        // 动态更新公式显示
        function updateFormulas(rgbMixed, cmyk1, cmyk2, cmykMixed, cmykToRgbResult, ratio1, ratio2) {
            // 更新RGB加色混合公式
            const rgbFormulaDiv = document.querySelector('.mixing-method:nth-child(1) .formula');
            rgbFormulaDiv.innerHTML = `
                <strong>加色混合公式：</strong><br>
                mixed = color1 × ratio1 + color2 × ratio2<br><br>
                
                <strong>当前比例：${Math.round(ratio1 * 100)}% : ${Math.round(ratio2 * 100)}%</strong><br><br>
                
                <strong>计算过程：</strong><br>
                R = ${currentColors.color1.r} × ${ratio1.toFixed(2)} + ${currentColors.color2.r} × ${ratio2.toFixed(2)} = ${(currentColors.color1.r * ratio1 + currentColors.color2.r * ratio2).toFixed(1)} ≈ ${rgbMixed.r}<br>
                G = ${currentColors.color1.g} × ${ratio1.toFixed(2)} + ${currentColors.color2.g} × ${ratio2.toFixed(2)} = ${(currentColors.color1.g * ratio1 + currentColors.color2.g * ratio2).toFixed(1)} ≈ ${rgbMixed.g}<br>
                B = ${currentColors.color1.b} × ${ratio1.toFixed(2)} + ${currentColors.color2.b} × ${ratio2.toFixed(2)} = ${(currentColors.color1.b * ratio1 + currentColors.color2.b * ratio2).toFixed(1)} ≈ ${rgbMixed.b}<br><br>
                
                <strong>结果：RGB(${rgbMixed.r}, ${rgbMixed.g}, ${rgbMixed.b})</strong>
            `;
            
            // 更新CMYK减色混合公式
            const cmykFormulaDiv = document.querySelector('.mixing-method:nth-child(2) .formula');
            cmykFormulaDiv.innerHTML = `
                <strong>步骤1：RGB转CMYK</strong><br>
                颜色1 RGB(${currentColors.color1.r}, ${currentColors.color1.g}, ${currentColors.color1.b}) → CMYK(${cmyk1.c}%, ${cmyk1.m}%, ${cmyk1.y}%, ${cmyk1.k}%)<br>
                颜色2 RGB(${currentColors.color2.r}, ${currentColors.color2.g}, ${currentColors.color2.b}) → CMYK(${cmyk2.c}%, ${cmyk2.m}%, ${cmyk2.y}%, ${cmyk2.k}%)<br><br>
                
                <strong>步骤2：CMYK减色混合（${Math.round(ratio1 * 100)}%:${Math.round(ratio2 * 100)}%比例）</strong><br>
                减色混合公式：mixed = 1 - (1 - d1×ratio1) × (1 - d2×ratio2)<br><br>
                
                C通道混合：<br>
                • 颜色1密度：${cmyk1.c}% × ${Math.round(ratio1 * 100)}% = ${Math.round(cmyk1.c * ratio1)}%<br>
                • 颜色2密度：${cmyk2.c}% × ${Math.round(ratio2 * 100)}% = ${Math.round(cmyk2.c * ratio2)}%<br>
                • 混合结果：1 - (1-${(cmyk1.c * ratio1 / 100).toFixed(2)}) × (1-${(cmyk2.c * ratio2 / 100).toFixed(2)}) = ${cmykMixed.c}%<br><br>
                
                M通道混合：<br>
                • 颜色1密度：${cmyk1.m}% × ${Math.round(ratio1 * 100)}% = ${Math.round(cmyk1.m * ratio1)}%<br>
                • 颜色2密度：${cmyk2.m}% × ${Math.round(ratio2 * 100)}% = ${Math.round(cmyk2.m * ratio2)}%<br>
                • 混合结果：1 - (1-${(cmyk1.m * ratio1 / 100).toFixed(2)}) × (1-${(cmyk2.m * ratio2 / 100).toFixed(2)}) = ${cmykMixed.m}%<br><br>
                
                Y通道混合：<br>
                • 颜色1密度：${cmyk1.y}% × ${Math.round(ratio1 * 100)}% = ${Math.round(cmyk1.y * ratio1)}%<br>
                • 颜色2密度：${cmyk2.y}% × ${Math.round(ratio2 * 100)}% = ${Math.round(cmyk2.y * ratio2)}%<br>
                • 混合结果：1 - (1-${(cmyk1.y * ratio1 / 100).toFixed(2)}) × (1-${(cmyk2.y * ratio2 / 100).toFixed(2)}) = ${cmykMixed.y}%<br><br>
                
                K通道混合：<br>
                • 颜色1密度：${cmyk1.k}% × ${Math.round(ratio1 * 100)}% = ${Math.round(cmyk1.k * ratio1)}%<br>
                • 颜色2密度：${cmyk2.k}% × ${Math.round(ratio2 * 100)}% = ${Math.round(cmyk2.k * ratio2)}%<br>
                • 混合结果：1 - (1-${(cmyk1.k * ratio1 / 100).toFixed(2)}) × (1-${(cmyk2.k * ratio2 / 100).toFixed(2)}) = ${cmykMixed.k}%<br><br>
                
                <strong>混合结果CMYK：C=${cmykMixed.c}%, M=${cmykMixed.m}%, Y=${cmykMixed.y}%, K=${cmykMixed.k}%</strong><br><br>
                
                <strong>步骤3：CMYK转回RGB</strong><br>
                转换公式：RGB = 255 × (1-C) × (1-K) （每个通道独立计算）<br><br>
                
                R = 255 × (1-${(cmykMixed.c/100).toFixed(2)}) × (1-${(cmykMixed.k/100).toFixed(2)}) = 255 × ${(1-cmykMixed.c/100).toFixed(2)} × ${(1-cmykMixed.k/100).toFixed(2)} = ${(255 * (1-cmykMixed.c/100) * (1-cmykMixed.k/100)).toFixed(1)} ≈ ${cmykToRgbResult.r}<br>
                G = 255 × (1-${(cmykMixed.m/100).toFixed(2)}) × (1-${(cmykMixed.k/100).toFixed(2)}) = 255 × ${(1-cmykMixed.m/100).toFixed(2)} × ${(1-cmykMixed.k/100).toFixed(2)} = ${(255 * (1-cmykMixed.m/100) * (1-cmykMixed.k/100)).toFixed(1)} ≈ ${cmykToRgbResult.g}<br>
                B = 255 × (1-${(cmykMixed.y/100).toFixed(2)}) × (1-${(cmykMixed.k/100).toFixed(2)}) = 255 × ${(1-cmykMixed.y/100).toFixed(2)} × ${(1-cmykMixed.k/100).toFixed(2)} = ${(255 * (1-cmykMixed.y/100) * (1-cmykMixed.k/100)).toFixed(1)} ≈ ${cmykToRgbResult.b}<br><br>
                
                <strong>最终结果：RGB(${cmykToRgbResult.r}, ${cmykToRgbResult.g}, ${cmykToRgbResult.b})</strong>
            `;
        }

        // 事件监听器
        document.addEventListener('DOMContentLoaded', function() {
            // 颜色选择器事件
            document.getElementById('color1Picker').addEventListener('input', function(e) {
                const rgb = hexToRgb(e.target.value);
                if (rgb) {
                    currentColors.color1 = rgb;
                    updateColorDisplay(1, rgb);
                    updateMixingResults();
                }
            });

            document.getElementById('color2Picker').addEventListener('input', function(e) {
                const rgb = hexToRgb(e.target.value);
                if (rgb) {
                    currentColors.color2 = rgb;
                    updateColorDisplay(2, rgb);
                    updateMixingResults();
                }
            });

            // 文本输入事件
            document.getElementById('color1Text').addEventListener('input', function(e) {
                const rgb = parseColorInput(e.target.value);
                if (rgb) {
                    currentColors.color1 = rgb;
                    updateColorDisplay(1, rgb);
                    updateMixingResults();
                }
            });

            document.getElementById('color2Text').addEventListener('input', function(e) {
                const rgb = parseColorInput(e.target.value);
                if (rgb) {
                    currentColors.color2 = rgb;
                    updateColorDisplay(2, rgb);
                    updateMixingResults();
                }
            });

            // 比例滑杆事件
            document.getElementById('mixRatio').addEventListener('input', function(e) {
                currentRatio = e.target.value / 100;
                updateMixingResults();
            });

            // 切换按钮事件
            document.getElementById('color1Toggle').addEventListener('click', function() {
                toggleInputFormat(1);
            });

            document.getElementById('color2Toggle').addEventListener('click', function() {
                toggleInputFormat(2);
            });

            // 结果复制事件
            document.getElementById('rgbDecResult').addEventListener('click', function() {
                copyToClipboard(this.textContent);
            });

            document.getElementById('rgbHexResult').addEventListener('click', function() {
                copyToClipboard(this.textContent);
            });

            document.getElementById('cmykDecResult').addEventListener('click', function() {
                copyToClipboard(this.textContent);
            });

            document.getElementById('cmykHexResult').addEventListener('click', function() {
                copyToClipboard(this.textContent);
            });

            // 初始化显示
            updateColorDisplay(1, currentColors.color1);
            updateColorDisplay(2, currentColors.color2);
            updateMixingResults();
        });
    </script>
</body>
</html>
